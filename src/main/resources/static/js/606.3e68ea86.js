"use strict";(self["webpackChunkvue_learning"]=self["webpackChunkvue_learning"]||[]).push([[606],{7606:function(e,t,l){l.r(t),l.d(t,{default:function(){return s}});var a=l(3396),o=l(2268);function r(e,t,l,r,n,u){const i=(0,a.up)("timer"),d=(0,a.up)("el-icon"),w=(0,a.up)("el-table-column"),s=(0,a.up)("el-tag"),m=(0,a.up)("el-popover"),c=(0,a.up)("clock"),f=(0,a.up)("el-button"),p=(0,a.up)("el-popconfirm"),g=(0,a.up)("el-table");return(0,a.wg)(),(0,a.j4)(g,{data:n.tableData,"table-layout":"fixed",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Uk)("x "),(0,a.Wm)(w,{label:"借阅时间",width:"180"},{default:(0,a.w5)((e=>[(0,a._)("div",null,[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(i)])),_:1}),(0,a._)("span",null,(0,o.zw)(e.row.borrowTime),1)])])),_:1}),(0,a.Wm)(w,{label:"书名"},{default:(0,a.w5)((e=>[(0,a.Wm)(m,{trigger:"hover",placement:"top",width:"auto"},{default:(0,a.w5)((()=>[(0,a._)("div",null," bookName: "+(0,o.zw)(e.row.book.bookName),1),(0,a._)("div",null,"author: "+(0,o.zw)(e.row.book.author),1)])),reference:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.book.bookName),1)])),_:2},1024)])),_:2},1024)])),_:1}),(0,a.Wm)(w,{label:"剩余天数"},{default:(0,a.w5)((e=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c)])),_:1}),(0,a.Wm)(m,{placement:"top",width:"auto",trigger:"hover"},{default:(0,a.w5)((()=>[(0,a._)("div",null,"还书截至日期: "+(0,o.zw)(u.deadline(e.row.borrowTime,e.row.lenDays)),1)])),reference:(0,a.w5)((()=>[(0,a.Wm)(s,{effect:"light",round:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(u.calculateDaysBetweenDates(e.row)),1)])),_:2},1024)])),_:2},1024)])),_:1}),(0,a.Wm)(w,{label:"状态"},{default:(0,a.w5)((e=>[e.row.overdue&&null===e.row.returnTime?((0,a.wg)(),(0,a.j4)(s,{key:0,effect:"light",type:"error"},{default:(0,a.w5)((()=>[(0,a.Uk)("逾期")])),_:1})):null===e.row.returnTime?((0,a.wg)(),(0,a.j4)(s,{key:1,effect:"light",type:"warning"},{default:(0,a.w5)((()=>[(0,a.Uk)("待还")])),_:1})):((0,a.wg)(),(0,a.j4)(s,{key:2,effect:"light",type:"success"},{default:(0,a.w5)((()=>[(0,a.Uk)("已还")])),_:1}))])),_:1}),(0,a.Wm)(w,{fixed:"right",label:"操作",width:"120"},{default:(0,a.w5)((e=>[(0,a.Wm)(f,{link:"",type:e.row.returnTime?"danger":"success",onClick:t=>u.handleReturn(e.row),disabled:null!=e.row.returnTime},{default:(0,a.w5)((()=>[(0,a.Uk)("归还")])),_:2},1032,["type","onClick","disabled"]),null===e.row.returnTime?((0,a.wg)(),(0,a.j4)(p,{key:0,icon:u.InfoFilled,title:"每次续借15天,最高借书31天;可续借次数:"+e.row.renewTime,onConfirm:t=>u.handleRenew(e.row)},{reference:(0,a.w5)((()=>[(0,a.Wm)(f,{link:"",type:"primary",disabled:e.row.overdue},{default:(0,a.w5)((()=>[(0,a.Uk)("续借")])),_:2},1032,["disabled"])])),_:2},1032,["icon","title","onConfirm"])):((0,a.wg)(),(0,a.j4)(p,{key:1,title:"确认删除",onConfirm:t=>u.handleDelete(e.$index,e.row)},{reference:(0,a.w5)((()=>[(0,a.Wm)(f,{link:"",type:"danger"},{default:(0,a.w5)((()=>[(0,a.Uk)("删除")])),_:1})])),_:2},1032,["onConfirm"]))])),_:1})])),_:1},8,["data"])}var n=l(2748),u=l(9168),i={name:"Rend_mila",computed:{InfoFilled(){return n.cEj}},components:{Clock:n.SUY,Timer:n.B7y},data(){return{tableData:[],visible:!1}},methods:{handleDelete(e,t){console.log(e),console.log(t),this.tableData.splice(e,1),u.Z.post("api/book/deleteRecord",t)},formDate(e){let t=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${l}-${a}`},handleReturn(e){e.returnTime=this.formDate(new Date),u.Z.post("api/book/returnBook",e).then((e=>{sessionStorage.setItem("user",JSON.stringify(e.data.data.customer))}))},deadline(e,t){const l=new Date(e);return l.setDate(l.getDate()+t),l.toISOString().split("T")[0]},calculateDaysBetweenDates(e){const t=new Date(e.borrowTime),l=new Date,a=864e5,o=l.getTime()-t.getTime();let r=parseInt(e.lenDays)-o/a;return o<=0?(e.overdue=!0,r=0):e.overdue=!1,e.resDays=r,Math.ceil(r)},handleRenew(e){u.Z.put("api/book/renewBook",e).then((t=>{e=t.data.data})),console.log(e),window.location.reload()}},mounted(){let e=JSON.parse(sessionStorage.getItem("user"));u.Z.post("api/book/record",e).then((e=>{this.tableData=e.data.data}))}},d=l(89);const w=(0,d.Z)(i,[["render",r]]);var s=w}}]);
//# sourceMappingURL=606.3e68ea86.js.map